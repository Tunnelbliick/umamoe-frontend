.chart-container {
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.03);
  backdrop-filter: blur(10px);
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border-primary);
  padding: 1rem;
  margin-bottom: 1rem;
  color: var(--text-primary);
  display: flex;
  flex-direction: column;
  min-height: 300px; // Ensure minimum height
  overflow: hidden; // Prevent chart overflow
  
  // Firefox scrollbar styling
  scrollbar-width: thin;
  scrollbar-color: rgba(100, 181, 246, 0.6) rgba(255, 255, 255, 0.05);
  
  // Webkit scrollbar styling (Chrome, Safari, Edge)
  &::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  
  &::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
  }
  
  &::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, rgba(100, 181, 246, 0.6), rgba(33, 150, 243, 0.6));
    border-radius: 4px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    
    &:hover {
      background: linear-gradient(180deg, rgba(100, 181, 246, 0.8), rgba(33, 150, 243, 0.8));
    }
  }
  
  &::-webkit-scrollbar-corner {
    background: rgba(255, 255, 255, 0.05);
  }
}

.chart-wrapper {
  flex: 1;
  min-height: 0; // Allow flex child to shrink
  position: relative;
  min-height: 250px; // Minimum height for mobile
  width: 100%;
  overflow: hidden; // Prevent canvas overflow
}

.chart-wrapper canvas {
  width: 100% !important;
  height: 100% !important;
  // Improve touch interactions on mobile
  touch-action: manipulation;
  max-width: 100%;
  max-height: 100%;
  image-rendering: -webkit-optimize-contrast; // Crisp image rendering
  image-rendering: crisp-edges;
}

@media (max-width: 768px) {
  .chart-container {
    padding: 0.5rem;
    margin-bottom: 0.75rem;
    min-height: 220px; // Optimized minimum height on mobile
    // Prevent unwanted scrolling behaviors
    overflow: visible;
    // Performance optimizations
    will-change: auto;
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }

  .chart-wrapper {
    min-height: 180px; // Better mobile height
    // Better touch handling
    touch-action: pan-x pan-y;
    -webkit-overflow-scrolling: touch;
    
    canvas {
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      
      // Better mobile rendering
      image-rendering: -webkit-optimize-contrast;
      image-rendering: optimize-contrast;
      image-rendering: crisp-edges;
      
      // Smooth interactions
      transition: none;
      
      // Prevent canvas stretching
      object-fit: contain;
      
      // Performance optimization
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
    }
  }

  .chart-header {
    flex-direction: column;
    gap: 0.75rem;
  }

  .chart-legend {
    gap: 0.5rem;
    font-size: 0.75rem;
  }
}

@media (max-width: 480px) {
  .chart-container {
    padding: 0.375rem;
    min-height: 200px; // Compact on small screens
    margin-bottom: 0.5rem;
  }

  .chart-wrapper {
    min-height: 160px; // Very compact on small screens
  }
}

// High DPI displays
@media (-webkit-min-device-pixel-ratio: 2),
       (min-resolution: 192dpi) {
  .chart-wrapper canvas {
    image-rendering: -webkit-optimize-contrast;
    image-rendering: optimize-contrast;
    image-rendering: crisp-edges;
  }
}