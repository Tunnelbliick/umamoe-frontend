.timeline-page {
  min-height: calc(100vh - 60px);
  display: flex;
  flex-direction: column;
  background:
    radial-gradient(circle at 20% 50%, rgba(100, 181, 246, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(129, 199, 132, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 80%, rgba(255, 183, 77, 0.1) 0%, transparent 50%);
  color: var(--text-primary);

  // Responsive breakpoint
  @media (max-width: 1150px) {

    // Hide desktop timeline on mobile
    .desktop-timeline {
      display: none;
    }
  }

  .desktop-timeline {
    min-height: calc(100vh - 60px);
    display: flex;
    flex-direction: column;
    position: relative; // For floating filter card positioning
  }

  @media (min-width: 1150px) {

    // Hide mobile timeline on desktop
    app-mobile-timeline {
      display: none;
    }
  }

  h1 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 2rem;
    font-weight: 600;
    color: var(--accent-primary);

    .page-icon {
      font-size: 2rem;
      width: 2rem;
      height: 2rem;
      color: var(--accent-primary);
      -webkit-text-fill-color: var(--accent-primary);
    }
  }

  .page-header {
    padding: 1rem 2rem;
    background: var(--bg-secondary);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border-primary);

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;

      .header-info {
        flex: 1 1 50%;
        min-width: 0;

        p {
          margin: 0.5rem 0;
          color: var(--text-secondary);
          font-size: 1rem;
          line-height: 1.4;
        }

        .event-count {
          font-size: 0.9rem;
          font-weight: 500;
          color: var(--accent-primary);
          margin-top: 0.25rem;
        }
      }

      .filter-controls {
        flex-shrink: 0;
        width: 100%;
        text-align: left;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        flex: 1 1 50%;
        margin: 0;
      }
    }
  }

  .current-date-display {
    padding: 1rem 2rem;
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;

    mat-card {
      background: var(--bg-secondary);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-primary);
      color: var(--text-primary);
      border-radius: var(--border-radius);

      .date-info {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 1.2rem;
        font-weight: 500;
        padding: 0.5rem;

        mat-icon {
          color: #FFD700;
        }
      }
    }
  }

  .timeline-wrapper {
    flex: 1;
    padding: 1rem 2rem;
    overflow: hidden;
    display: flex;
    flex-direction: column;

    .timeline-container {
      flex: 1;
      display: flex;
      align-items: center;
      overflow-x: auto;
      overflow-y: hidden;
      position: relative;
      border-radius: 12px;
      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.3) transparent;

      // Smooth scrolling for programmatic scrolls
      scroll-behavior: smooth;

      // Disable smooth scrolling when dragging
      &.is-dragging {
        scroll-behavior: auto;
      }

      // Chrome scrolling optimizations
      -webkit-overflow-scrolling: touch;
      transform: translateZ(0);
      backface-visibility: hidden;
      will-change: scroll-position;

      // Drag scrolling styles
      cursor: grab;
      user-select: none; // Prevent text selection during drag

      &:active {
        cursor: grabbing;
      }

      // Removed problematic properties that can interfere with Chrome scrolling
      // will-change: scroll-position; // Can cause scrolling issues in Chrome
      // transform: translateZ(0); // Can interfere with scrollbar in Chrome
      // contain: layout style; // Can break scrolling in some Chrome versions

      // Enhanced scrollbar styling for Chrome compatibility
      &::-webkit-scrollbar {
        height: 16px; // Increased from 12px for better Chrome compatibility
        width: 16px;
      }

      &::-webkit-scrollbar-track {
        background: var(--bg-tertiary);
        border-radius: 8px;
        margin: 0 4px; // Add margins to prevent track from touching edges
      }

      &::-webkit-scrollbar-thumb {
        background: var(--bg-quaternary);
        border-radius: 8px;
        border: 2px solid var(--bg-tertiary); // Add border for better definition
        min-width: 20px; // Ensure minimum thumb size

        &:hover {
          background: var(--accent-primary);
        }

        &:active {
          background: var(--accent-secondary);
        }
      }

      &::-webkit-scrollbar-corner {
        background: var(--bg-tertiary);
      }

      // Chrome-specific scrolling fixes
      @supports (-webkit-appearance: none) {
        .timeline-page .timeline-wrapper .timeline-container {
          // Force Chrome to show scrollbars
          overflow-x: scroll !important;

          // Additional Chrome scrollbar fixes
          &::-webkit-scrollbar {
            height: 18px !important; // Even larger for Chrome
            -webkit-appearance: none;
          }

          &::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1) !important;
            border-radius: 9px !important;
          }

          &::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3) !important;
            border-radius: 9px !important;
            border: 3px solid rgba(255, 255, 255, 0.1) !important;

            &:hover {
              background: rgba(100, 181, 246, 0.7) !important;
            }
          }
        }
      }

      // Fallback for browsers that don't support custom scrollbars
      @supports not ((-webkit-appearance: none) or (-moz-appearance: none)) {
        .timeline-page .timeline-wrapper .timeline-container {
          scrollbar-width: thick;
          scrollbar-color: rgba(255, 255, 255, 0.3) rgba(255, 255, 255, 0.1);
        }
      }

      .timeline-track {
        position: relative;
        height: 100%;
        min-height: 300px;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: flex-start;

        // Prevent text selection during dragging
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;

        // Simplified rendering optimization - removed contain property for Chrome compatibility

        .timeline-line {
          position: absolute;
          top: 50%;
          left: 0;
          width: 100%;
          height: 4px;
          background: linear-gradient(to right,
              var(--accent-primary),
              var(--accent-secondary),
              #ffb74d,
              #ff8a65);
          border-radius: 2px;
          box-shadow: var(--shadow-md);
          transform: translateY(-50%);
        }

        .timeline-item {
          position: absolute;
          top: 50%;
          height: auto;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          z-index: 2;
          transform: translateY(-50%);

          // Chrome-compatible optimizations
          backface-visibility: hidden;
          -webkit-backface-visibility: hidden;

          // Ensure items use the full height
          min-height: auto;

          // Anniversary items should have higher z-index
          &.timeline-anniversary {
            z-index: 5;
          }

          .timeline-marker {
            display: flex;
            flex-direction: column;
            align-items: center;

            .marker-dot {
              width: 12px;
              height: 12px;
              border-radius: 50%;
              background: white;
              border: 3px solid;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
              margin-bottom: 4px;

              &.marker-milestone {
                width: 20px;
                height: 20px;
                background: #FFD700;
                border-color: #FFA500;
              }

              &.marker-year {
                width: 16px;
                height: 16px;
                background: #FF6B6B;
                border-color: #FF5252;
              }

              &.marker-month {
                width: 10px;
                height: 10px;
                background: #4ECDC4;
                border-color: #26C6DA;
              }
            }

            .marker-line {
              width: 2px;
              height: 30px;
              background: rgba(255, 255, 255, 0.5);
            }
          }

          .timeline-label {
            text-align: center;
            margin-top: 0.5rem;
            background: var(--bg-tertiary);
            padding: 0.25rem 0.5rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-primary);
            backdrop-filter: blur(5px);
            min-width: 80px;

            span {
              display: block;
              font-weight: 600;
              font-size: 0.9rem;
              color: var(--text-primary);
            }

            small {
              display: block;
              color: var(--text-muted);
              font-size: 0.7rem;
            }
          }

          &.timeline-milestone .timeline-label {
            background: rgba(255, 215, 0, 0.2);
            border-color: #FFD700;

            span {
              color: #FFD700;
            }
          }

          .milestone-label {
            text-align: center;
            margin-top: 0.5rem;
            min-width: 80px;

            span {
              display: block;
              font-weight: 600;
              font-size: 0.9rem;
              color: var(--accent-primary);
            }

            small {
              display: block;
              color: var(--accent-primary);
              font-size: 0.7rem;
            }
          }

          .anniversary-label {
            text-align: center;
            margin-top: 0.5rem;
            min-width: 120px;

            span {
              display: block;
              font-weight: 600;
              font-size: 0.9rem;
              color: #E91E63;
              text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            }

            small {
              display: block;
              color: #E91E63;
              font-size: 0.7rem;
              opacity: 0.8;
            }
          }

          .today-label {
            text-align: center;
            margin-top: 1.5rem;
            min-width: 100px;

            span {
              display: block;
              font-weight: 700;
              font-size: 1rem;
              color: #FF5722;
              text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
              animation: text-glow 2s infinite;
            }

            small {
              display: block;
              color: #FF5722;
              font-size: 0.75rem;
              font-weight: 600;
              opacity: 0.9;
            }
          }

          &.timeline-year {
            .center-marker {
              display: none;
            }

            .connection-line {
              display: none;
            }

            &::before {
              content: '';
              position: absolute;
              top: 0;
              bottom: 0;
              left: 50%;
              width: 1px;
              background: rgba(255, 255, 255, 0.1);
              transform: translateX(-50%);
              z-index: 0;
            }

            .item-content {
              position: absolute;
              top: -30px;
              left: 50%;
              transform: translateX(-50%);

              .timeline-label {
                background: transparent;
                border: none;
                padding: 0.25rem 0.5rem;
                text-align: center;
                opacity: 0.6;

                span {
                  color: var(--text-secondary);
                  font-size: 0.8rem;
                  font-weight: 500;
                }

                small {
                  display: none;
                }
              }
            }
          }

          &.timeline-month {
            display: none; // Hide month markers completely
          }
        }

        // Event cards and alternating sides
        .timeline-item {
          transform: scale(0.95);

          // When event-card is hovered, apply z-index to the entire timeline-item
          &:hover {
            z-index: 100 !important;

            // Ensure all child elements maintain their relative positioning
            .connection-line,
            .center-marker,
            .item-content {
              z-index: inherit;
            }
          }

          &.side-top .item-content {
            // Position is now set dynamically in Angular
            transform-origin: top center;
          }

          &.side-bottom .item-content {
            // Position is now set dynamically in Angular  
            transform-origin: top center;
          }

          .connection-line {
            position: absolute;
            background: var(--border-secondary);
            z-index: 0;
            left: 50%;
            transform: translateX(-50%);

            &.line-top {
              height: 75px;
              width: 2px;
              transform: translate(-50%, -50%);
            }

            &.line-bottom {
              height: 75px;
              width: 2px;
              transform: translate(-50%, 50%);
            }

            &.line-center {
              display: none;
            }
          }

          .center-marker {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 3;

            // Anniversary markers should be above others
            .marker-anniversary {
              z-index: 15;
              position: relative;
            }

            .marker-dot {
              width: 12px;
              height: 12px;
              border-radius: 50%;
              background: var(--text-primary);
              border: 3px solid;
              box-shadow: var(--shadow-sm);

              &.marker-event {
                background: var(--accent-secondary);
                border-color: #26C6DA;
              }

              &.marker-milestone {
                width: 32px;
                height: 32px;
                background: linear-gradient(45deg, #FF6B6B, #FFD700);
                border-color: #FFA500;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
                color: white;

                &::before {
                  content: 'ðŸš€';
                  font-size: 18px;
                }
              }

              &.marker-anniversary {
                width: 32px;
                height: 32px;
                background: linear-gradient(45deg, #E91E63, #F8BBD9);
                border-color: #C2185B;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
                color: white;
                z-index: 15; // Higher z-index than other markers

                &::before {
                  content: 'ðŸŽ';
                  font-size: 18px;
                }
              }

              &.marker-today {
                width: 24px;
                height: 24px;
                background: linear-gradient(45deg, #FF5722, #FF8A65);
                border-color: #D84315;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
                color: white;
                z-index: 20; // Highest z-index to ensure it's always visible
                box-shadow: 0 0 12px rgba(255, 87, 34, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3);
                animation: pulse-today 2s infinite;
              }

              &.marker-year {
                width: 16px;
                height: 16px;
                background: #FF6B6B;
                border-color: #FF5252;
              }

              &.marker-month {
                width: 10px;
                height: 10px;
                background: var(--accent-secondary);
                border-color: #26C6DA;
              }
            }
          }

          .item-content {
            position: absolute;
            min-width: 280px;
            max-width: 320px;

            &.content-top {
              transform: translate(0%, -60px);

              &.grouped-content {
                transform: translate(0%, -80px); // Extra space for group connector
              }
            }

            &.content-bottom {
              transform: translate(0%, 60px);

              &.grouped-content {
                transform: translate(0%, 80px); // Extra space for group connector
              }
            }

            &.content-center {
              top: 100%;
              margin-top: 0.5rem;
            }

            .event-card {
              background: var(--bg-tertiary);
              border: 1px solid var(--border-secondary);
              color: var(--text-primary);
              padding: 0;
              border-radius: var(--border-radius);
              overflow: hidden;

              // Simplified performance optimizations
              will-change: auto; // Remove will-change to prevent unnecessary layer creation
              // Removed backdrop-filter as it's expensive during scroll
              // Reduced box-shadow complexity
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);

              // Use simpler transitions
              transition: border-color 0.2s ease, background-color 0.2s ease;

              &:hover {
                background: var(--bg-quaternary);
                border-color: var(--accent-primary);
                // Removed expensive hover effects that cause repaints during scroll
              }

              // Event type specific styling using classes
              &.event-type-champions_meeting {
                border-left: 4px solid #9c27b0;

                &:hover {
                  border-color: #9c27b0;
                  box-shadow: 0 2px 8px rgba(156, 39, 176);
                }
              }

              &.event-type-legend_race {
                border-left: 4px solid #e91e63;

                &:hover {
                  border-color: #e91e63;
                  box-shadow: 0 1px 8px rgba(233, 30, 99);
                }
              }

              &.event-type-paid_banner {
                border-left: 4px solid #ff9800;

                &:hover {
                  border-color: #ff9800;
                  box-shadow: 0 1px 8px rgba(255, 152, 0);
                }
              }

              &.event-type-story_event {
                border-left: 4px solid #ffb74d;

                &:hover {
                  border-color: #ffb74d;
                  box-shadow: 0 1px 8px rgba(255, 183, 77);
                }
              }

              &.event-type-character_banner {
                border-left: 4px solid var(--accent-primary);

                &:hover {
                  border-color: var(--accent-primary);
                  box-shadow: 0 1px 8px var(--accent-primary);
                }
              }

              &.event-type-support_card_banner {
                border-left: 4px solid var(--accent-secondary);

                &:hover {
                  border-color: var(--accent-secondary);
                  box-shadow: 0 1px 8px var(--accent-secondary);
                }
              }

              // Grouped events styling
              &.grouped-event {
                position: relative;
                z-index: auto;
                transition: box-shadow 0.3s var(--ease-out), border-color 0.3s, transform 0.2s cubic-bezier(.4, 1.3, .6, 1);

                // Add a small margin to prevent hover conflicts between adjacent cards
                margin-right: 8px;

                // Create a custom hover area using pseudo-element
                &::before {
                  content: '';
                  position: absolute;
                  top: 0;
                  bottom: 0;
                  z-index: 10; // Above the card content
                  pointer-events: auto;
                  // Default: right half is the hover area (for cards that overlap on the left)
                  left: 50%;
                  right: 0;
                }

                // First card: left portion is the hover area (since it's not overlapped on the left)
                &:first-of-type::before {
                  left: 0;
                  right: 50%;
                }

                // Middle cards: only the center portion is hoverable
                &:not(:first-of-type):not(:last-of-type)::before {
                  left: 25%;
                  right: 25%;
                }

                // Last card: right portion is the hover area
                &:last-of-type::before {
                  left: 50%;
                  right: 0;
                }

                // Make sure content areas can be interacted with despite the pseudo-element
                .event-content,
                .event-tags {
                  position: relative;
                  z-index: 11; // Above the hover pseudo-element
                  pointer-events: auto;
                }

                .event-tags {
                  padding-top: 1px;
                }

                // On hover, simplified effect to reduce repaints
                &:hover {
                  z-index: 200 !important;
                  // Removed expensive scale and shadow transforms
                }

                // Remove margin from the last card in a group to avoid extra spacing
                &:last-of-type {
                  margin-right: 0;
                }
              }

              .event-image {
                width: 100%;
                height: 120px;
                overflow: hidden;
                border-radius: var(--border-radius) var(--border-radius) 0 0;

                img {
                  width: 100%;
                  height: 100%;
                  object-fit: contain;
                  // Removed expensive hover scale transform
                }

                // Legend race specific styling for overlapping images
                .legend-race-images {
                  position: relative;
                  width: 100%;
                  height: 100%;
                  display: flex;
                  align-items: center;
                  overflow: hidden;

                  .legend-race-image {
                    position: absolute;
                    width: 60%; // Make each image smaller to allow for overlap
                    height: 80%;
                    object-fit: contain;
                    border-radius: 4px;
                    transition: transform 0.2s ease;
                  }
                }
              }

              .event-image-placeholder {
                width: 100%;
                height: 120px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: linear-gradient(135deg, var(--bg-secondary), var(--bg-quaternary));
                border-radius: var(--border-radius) var(--border-radius) 0 0;

                .placeholder-icon-character {
                  color: var(--accent-primary);
                  font-size: 3rem;
                  width: 3rem;
                  height: 3rem;
                }

                .placeholder-icon-support-card {
                  color: var(--accent-secondary);
                  font-size: 3rem;
                  width: 3rem;
                  height: 3rem;
                }

                .placeholder-icon-event {
                  color: #ffb74d;
                  font-size: 3rem;
                  width: 3rem;
                  height: 3rem;
                }

                .placeholder-icon-story_event {
                  color: #ffb74d;
                  font-size: 3rem;
                  width: 3rem;
                  height: 3rem;
                }

                .placeholder-icon-champions_meeting {
                  color: #9c27b0; // Purple for Champions Meeting
                  font-size: 3rem;
                  width: 3rem;
                  height: 3rem;
                }

                .placeholder-icon-legend_race {
                  color: #e91e63; // Pink/Red for Legend Race
                  font-size: 3rem;
                  width: 3rem;
                  height: 3rem;
                }

                .placeholder-icon-paid_banner {
                  color: #ff9800; // Orange for Paid Banners
                  font-size: 3rem;
                  width: 3rem;
                  height: 3rem;
                }

                .placeholder-icon-campaign {
                  color: #ff8a65;
                  font-size: 3rem;
                  width: 3rem;
                  height: 3rem;
                }

                .placeholder-icon-milestone {
                  color: #FFD700;
                  font-size: 3rem;
                  width: 3rem;
                  height: 3rem;
                }
              }

              .event-content {
                padding: 1rem;
              }

              .event-header {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-bottom: 0.75rem;
                padding-bottom: 0.5rem;
                border-bottom: 1px solid var(--border-primary);

                mat-icon {
                  font-size: 1.2rem;
                  width: 1.2rem;
                  height: 1.2rem;

                  &.event-icon-character {
                    color: var(--accent-primary);
                  }

                  &.event-icon-support-card {
                    color: var(--accent-secondary);
                  }

                  &.event-icon-event {
                    color: #ffb74d;
                  }

                  &.event-icon-story_event {
                    color: #ffb74d;
                  }

                  &.event-icon-champions_meeting {
                    color: #9c27b0; // Purple for Champions Meeting
                  }

                  &.event-icon-legend_race {
                    color: #e91e63; // Pink/Red for Legend Race
                  }

                  &.event-icon-paid_banner {
                    color: #ff9800; // Orange for Paid Banners
                  }

                  &.event-icon-campaign {
                    color: #ff8a65;
                  }
                }

                .event-type {
                  font-size: 0.8rem;
                  font-weight: 600;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                  color: var(--text-secondary);
                }
              }

              .event-title {
                font-size: 1rem;
                font-weight: 600;
                margin-bottom: 0.5rem;
                color: var(--text-primary);
              }

              .event-description {
                font-size: 0.875rem;
                line-height: 1.4;
                margin-bottom: 0.75rem;
                color: var(--text-secondary);
              }

              .event-date {
                font-size: 0.75rem;
                color: #FFD700;
                font-weight: 500;
                margin-bottom: 0.5rem;
              }

              .event-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 0.25rem;
                max-height: 150px;
                overflow-y: auto;

                // Custom scrollbar
                &::-webkit-scrollbar {
                  height: 5px;
                  width: 5px;
                }

                &::-webkit-scrollbar-track {
                  background: var(--bg-tertiary);
                  border-radius: 6px;
                }

                &::-webkit-scrollbar-thumb {
                  background: var(--bg-quaternary);
                  border-radius: 6px;
                  border: 1px solid var(--border-primary);

                  &:hover {
                    background: var(--accent-primary);
                  }
                }

                .character-chip {
                  background: rgba(100, 181, 246, 0.2);
                  color: var(--accent-primary);
                  padding: 0.2rem 0.5rem;
                  border-radius: var(--border-radius);
                  font-size: 0.7rem;
                  font-weight: 500;
                  border: 1px solid rgba(100, 181, 246, 0.3);
                }

                .support-chip {
                  background: rgba(186, 104, 200, 0.2);
                  color: #ba68c8;
                  padding: 0.2rem 0.5rem;
                  border-radius: var(--border-radius);
                  font-size: 0.7rem;
                  font-weight: 500;
                  border: 1px solid rgba(186, 104, 200, 0.3);
                }
              }
            }
          }
        }

        .timeline-milestone {
          position: absolute;
          top: 50%;
          height: auto;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          z-index: 10;
          transform: translateY(-50%);

          .milestone-marker {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.5);
            border: 3px solid var(--text-primary);

            mat-icon {
              color: var(--text-primary);
              font-size: 1.5rem;
              width: 1.5rem;
              height: 1.5rem;
            }
          }

          .milestone-label {
            padding-top: 0.25rem;
            text-align: center;
            backdrop-filter: blur(10px);

            small {
              display: block;
              color: var(--text-primary);
              font-size: 0.9rem;
              margin-top: 0.25rem;
            }
          }

          .anniversary-label {
            padding-top: 0.25rem;
            transform: translateX(50%);
            text-align: center;
            backdrop-filter: blur(10px);
            min-width: 120px;

            span {
              display: block;
              color: #E91E63;
              font-weight: 600;
              font-size: 0.85rem;
              text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
              margin-bottom: 0.25rem;
            }

            small {
              display: block;
              color: #E91E63;
              font-weight: 600;
              font-size: 0.75rem;
              text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
              opacity: 0.9;
            }
          }
        }
      }
    }
  }

  .filter-controls {
    margin: 0;
    padding: 1rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--border-radius);
    backdrop-filter: blur(10px);
    box-shadow: var(--shadow-sm);

    .search-field {
      flex: 1;
      margin-bottom: 0;
    }

    .search-navigation {
      display: flex;
      align-items: center; // Vertically center content
      justify-content: center; // Center horizontally if desired
      gap: 0.5rem;
      margin-bottom: 1rem;

      button[mat-icon-button] {
        width: 40px;
        height: 40px;
        min-width: 40px;
        min-height: 40px;
        border-radius: 50% !important; // Make sure it's a circle
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;

        // Fix highlight/active state to be circular
        .mat-mdc-button-persistent-ripple,
        .mat-mdc-button-ripple {
          border-radius: 50% !important;
        }
      }

      .search-results-text,
      .no-results-text {
        min-width: 48px;
        text-align: center;
        font-size: 1rem;
        font-weight: 500;
      }
    }

    .filter-section {
      margin-top: -1.2rem;
      flex: 1 1 100%;

      .filter-toggles {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        flex-direction: row;

        mat-checkbox {
          margin: 0;

          ::ng-deep .mdc-form-field {
            align-items: center;
            margin: 0;
          }

          ::ng-deep .mdc-form-field>label {
            margin: 0;
            padding: 0;
          }

          .checkbox-content {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            line-height: 1;

            mat-icon {
              font-size: 1.1rem;
              width: 1.1rem;
              height: 1.1rem;
              margin: 0;
            }

            span {
              margin: 0;
              padding: 0;
            }
          }

          &.character-toggle {
            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: var(--accent-primary) !important;
              border-color: var(--accent-primary) !important;
            }
          }

          &.support-toggle {
            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: var(--accent-secondary) !important;
              border-color: var(--accent-secondary) !important;
            }
          }

          &.story-events-toggle {
            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: #ffb74d !important;
              border-color: #ffb74d !important;
            }
          }

          &.champions-toggle {
            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: #9c27b0 !important;
              border-color: #9c27b0 !important;
            }
          }

          &.legend-races-toggle {
            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: #e91e63 !important;
              border-color: #e91e63 !important;
            }
          }

          &.paid-toggle {
            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: #ff9800 !important;
              border-color: #ff9800 !important;
            }
          }

          &.special-toggle {
            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: #ffb74d !important;
              border-color: #ffb74d !important;
            }
          }
        }
      }
    }

    // Mobile responsiveness
    @media (max-width: 768px) {
      padding: 0.75rem;

      .search-section {
        .search-field {
          max-width: 100%;
        }

        .search-navigation {
          flex-direction: column;
          gap: 0.75rem;
          align-items: stretch;

          .search-results-text,
          .no-results-text {
            min-width: 0; // Allow text to wrap
            text-align: left;
            font-size: 0.9rem;
          }
        }
      }

      .filter-section {
        .filter-toggles {
          flex-direction: column;
          gap: 0.75rem;
          align-items: flex-start;
        }
      }
    }
  }

  // Mobile responsiveness
  @media (max-width: 768px) {
    .timeline-page {
      .page-header {
        padding: 1rem;

        .header-content {
          flex-direction: column;
          gap: 1rem;
          text-align: center;
          align-items: center;

          .header-info {
            text-align: center;

            h1 {
              font-size: 1.5rem;
            }
          }

          .filter-controls {
            width: 100%;
            text-align: left;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            flex: 1;
          }
        }
      }

      .current-date-display,
      .timeline-wrapper,
      .timeline-controls {
        padding: 1rem;
      }

      .timeline-wrapper .timeline-container {
        padding: 1rem;

        .timeline-track .timeline-item .timeline-label {
          font-size: 0.8rem;
          min-width: 60px;

          span {
            font-size: 0.8rem;
          }

          small {
            font-size: 0.6rem;
          }
        }
      }

      .timeline-controls .controls-content {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
    }
  }

  // Mobile responsive adjustments for grouped events
  @media (max-width: 768px) {
    .timeline-page {
      .timeline-wrapper {
        .timeline-container {
          .timeline-track {
            .timeline-item {
              &.grouped-content {
                .event-card.grouped-event {
                  // On mobile, reduce horizontal spacing between grouped events
                  --group-offset: calc(var(--group-index, 0) * 140px);
                  transform: translateX(var(--group-offset)) !important;

                  &:hover {
                    // Maintain mobile spacing on hover with scale
                    transform: translateX(var(--group-offset)) translateY(-4px) scale(1.02) !important;
                  }
                }

                .group-connector {
                  left: 70px; // Adjust for smaller card spacing

                  .connector-line {
                    // Adjust connector width for mobile
                    width: calc(100% - 20px);
                  }
                }
              }
            }
          }
        }
      }
    }
  }


  // Compact mode styles
  .compact-header {
    padding: 0.75rem 2rem;
    background: var(--bg-secondary);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border-primary);

    .compact-header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;

      h1 {
        margin: 0;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;

        .page-icon {
          color: var(--accent-color);
        }
      }

      .event-count {
        margin: 0;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }
    }
  }

  // Floating filter card
  .floating-filter-card {
    position: fixed;
    top: 50%;
    right: 20px;
    transform: translateY(-50%);
    width: 280px;
    max-height: 80vh;
    overflow-y: auto;
    z-index: 1000;
    background: var(--bg-secondary);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-primary);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);

    mat-card-header {
      padding-bottom: 0.5rem;

      mat-card-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.1rem;
        margin: 0;

        mat-icon {
          color: var(--accent-color);
          font-size: 1.2rem;
        }
      }
    }

    mat-card-content {
      padding-top: 0.5rem;

      .compact-search-field {
        width: 100%;

        mat-label {
          font-size: 0.9rem;
        }
      }

      .compact-search-navigation {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1rem;

        // Add a soft background and rounded corners
        background: var(--bg-tertiary, rgba(255, 255, 255, 0.06));
        border-radius: 1.5rem;
        padding: 0.5rem 0.75rem;

        // Optional: subtle border for extra separation
        border: 1px solid var(--border-primary, rgba(255, 255, 255, 0.08));

        button[mat-icon-button] {
          width: 40px;
          height: 40px;
          min-width: 40px;
          min-height: 40px;
          border-radius: 50% !important;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 0;

          .mat-mdc-button-persistent-ripple,
          .mat-mdc-button-ripple {
            border-radius: 50% !important;
          }
        }

        .search-results-text,
        .no-results-text {
          min-width: 48px;
          text-align: center;
          font-size: 1rem;
          font-weight: 500;
        }
      }

      .compact-filter-section {
        .compact-filter-toggles {
          display: flex;
          flex-direction: column;
          gap: 0.75rem;

          mat-checkbox {
            margin: 0;

            ::ng-deep .mdc-form-field>label {
              margin: 0;
              padding: 0;
            }

            .compact-checkbox-content {
              display: flex;
              align-items: center;
              gap: 0.5rem;
              font-size: 0.9rem;
              font-weight: 500;
              line-height: 1;

              mat-icon {
                font-size: 1.1rem;
                width: 1.1rem;
                height: 1.1rem;
                margin: 0;
              }

              span {
                margin: 0;
                padding: 0;
              }
            }
          }

          .compact-character-toggle {
            .compact-checkbox-content mat-icon {
              color: #64b5f6;
            }

            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: var(--accent-primary) !important;
              border-color: var(--accent-primary) !important;
            }
          }

          .compact-support-toggle {
            .compact-checkbox-content mat-icon {
              color: #81c784;
            }

            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: var(--accent-secondary) !important;
              border-color: var(--accent-secondary) !important;
            }
          }

          .compact-story-events-toggle {
            .compact-checkbox-content mat-icon {
              color: #ffb74d;
            }

            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: #ffb74d !important;
              border-color: #ffb74d !important;
            }
          }

          .compact-champions-toggle {
            .compact-checkbox-content mat-icon {
              color: #9c27b0;
            }

            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: #9c27b0 !important;
              border-color: #9c27b0 !important;
            }
          }

          .compact-legend-races-toggle {
            .compact-checkbox-content mat-icon {
              color: #e91e63;
            }

            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: #e91e63 !important;
              border-color: #e91e63 !important;
            }
          }

          .compact-paid-toggle {
            .compact-checkbox-content mat-icon {
              color: #ff9800;
            }

            ::ng-deep .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background {
              background-color: #ff9800 !important;
              border-color: #ff9800 !important;
            }
          }
        }
      }
    }
  }

  // Compact timeline wrapper
  .timeline-wrapper.compact-timeline {
    flex: 1;
    // Remove padding-right so filter only overlaps timeline content
  }

  // Mobile responsiveness
  @media (max-width: 768px) {
    .timeline-page {
      .page-header {
        padding: 1rem;

        .header-content {
          flex-direction: column;
          gap: 1rem;
          text-align: center;
          align-items: center;

          .header-info {
            text-align: center;

            h1 {
              font-size: 1.5rem;
            }
          }

          .filter-controls {
            width: 100%;
            text-align: left;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            flex: 1;
          }
        }
      }

      .current-date-display,
      .timeline-wrapper,
      .timeline-controls {
        padding: 1rem;
      }

      .timeline-wrapper .timeline-container {
        padding: 1rem;

        .timeline-track .timeline-item .timeline-label {
          font-size: 0.8rem;
          min-width: 60px;

          span {
            font-size: 0.8rem;
          }

          small {
            font-size: 0.6rem;
          }
        }
      }

      .timeline-controls .controls-content {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
    }
  }

  // Mobile responsive adjustments for grouped events
  @media (max-width: 768px) {
    .timeline-page {
      .timeline-wrapper {
        .timeline-container {
          .timeline-track {
            .timeline-item {
              &.grouped-content {
                .event-card.grouped-event {
                  // On mobile, reduce horizontal spacing between grouped events
                  --group-offset: calc(var(--group-index, 0) * 140px);
                  transform: translateX(var(--group-offset)) !important;

                  &:hover {
                    // Maintain mobile spacing on hover with scale
                    transform: translateX(var(--group-offset)) translateY(-4px) scale(1.02) !important;
                  }
                }

                .group-connector {
                  left: 70px; // Adjust for smaller card spacing

                  .connector-line {
                    // Adjust connector width for mobile
                    width: calc(100% - 20px);
                  }
                }
              }
            }
          }
        }
      }
    }
  }

  // Responsive adjustments for compact mode
  @media (max-width: 1400px) {
    .floating-filter-card {
      width: 240px;
      right: 15px;
    }
  }

  @media (max-width: 1300px) {
    .floating-filter-card {
      width: 220px;
      right: 10px;
    }
  }

  // Hide floating card on very narrow screens
  @media (max-width: 1200px) {
    .floating-filter-card {
      display: none;
    }

    // Fallback to regular header on narrow screens even in compact mode
    .compact-header {
      display: none;
    }

    .page-header {
      display: block !important;
    }
  }

  // Existing styles below...
}

// Animation for today marker
@keyframes pulse-today {

  0%,
  100% {
    box-shadow: 0 0 12px rgba(255, 87, 34, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3);
    transform: scale(1);
  }

  50% {
    box-shadow: 0 0 20px rgba(255, 87, 34, 0.8), 0 2px 12px rgba(0, 0, 0, 0.4);
    transform: scale(1.1);
  }
}

// Animation for today label text
@keyframes text-glow {

  0%,
  100% {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  }

  50% {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3), 0 0 8px rgba(255, 87, 34, 0.6);
  }
}